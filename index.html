<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>URICO | ä¸å‹•ç”£å£²å´ä¸€æ‹¬æŸ»å®š - é–¢è¥¿æœ€å¤§ç´šã®è³¼å…¥å¸Œæœ›è€…ãƒãƒƒãƒãƒ³ã‚°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet" />
    <style>
        :root {
            --primary-color: #FF6B6B;
            --secondary-color: #4ECDC4;
            --dark-color: #2C3E50;
            --light-color: #F7F9F9;
            --white: #FFFFFF;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            color: var(--dark-color);
            background-color: var(--light-color);
            line-height: 1.6;
        }

        .campaign-banner {
            background-color: #FF4757;
            color: white;
            text-align: center;
            padding: 10px 0;
            font-size: 16px;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 1001;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
    
        header {
            background: var(--white);
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 40px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
    
        @media (max-width: 768px) {
            header { top: 0; }
            .campaign-banner { font-size: 14px; }
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .logo img { height: 40px; }

        nav { display: flex; gap: 20px; align-items: center; }
        nav a { text-decoration: none; color: var(--dark-color); font-weight: 500; transition: color 0.3s; }
        nav a:hover { color: var(--primary-color); }

        .hero {
            padding: 80px 5%;
            text-align: center;
            background: linear-gradient(135deg, #FFF5F5 0%, #FFFFFF 100%);
        }

        .hero h1 { font-size: 42px; margin-bottom: 20px; color: var(--dark-color); }
        .hero h1 span { color: var(--primary-color); }
        .hero p { font-size: 18px; color: #666; margin-bottom: 40px; }

        .stats-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 60px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: var(--white);
            padding: 30px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            min-width: 250px;
            text-align: center;
        }

        .stat-card .number { font-size: 36px; font-weight: 700; color: var(--primary-color); display: block; margin-bottom: 5px; }
        .stat-card .label { font-size: 14px; color: #888; }

        .search-section { max-width: 800px; margin: 0 auto; position: relative; }

        .search-tabs { display: flex; justify-content: center; margin-bottom: 20px; }

        .tab-button {
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            border: none;
            background: #e0e0e0;
            color: #555;
            transition: background-color 0.3s, color 0.3s;
            border-radius: 10px 10px 0 0;
            margin: 0 2px;
        }

        .tab-button.active {
            background: var(--white);
            color: var(--primary-color);
            box-shadow: var(--shadow);
            z-index: 1;
        }

        .tab-content {
            background: var(--white);
            padding: 30px;
            border-radius: 0 10px 10px 10px;
            box-shadow: var(--shadow);
            margin-top: -1px;
        }

        .search-box { display: flex; gap: 10px; margin-bottom: 10px; position: relative; }
        .search-input { flex: 1; border: 1px solid #ddd; padding: 15px; font-size: 16px; outline: none; border-radius: 8px; }
        .search-btn { background: var(--primary-color); color: var(--white); border: none; padding: 15px 30px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: opacity 0.3s; white-space: nowrap; }
        .search-btn:hover { opacity: 0.9; }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border: 1px solid #ddd;
            border-radius: 0 0 10px 10px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .suggestion-item {
            padding: 12px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }

        .suggestion-item:hover { background-color: #f9f9f9; }
        .mansion-name { font-weight: 500; }
        .buyer-count { font-size: 12px; color: var(--primary-color); background: #FFF0F0; padding: 2px 8px; border-radius: 4px; }

        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; color: var(--dark-color); }
        select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; background-color: var(--white); transition: border-color 0.3s; }
        select:focus { border-color: var(--primary-color); outline: none; }

        button.search-btn-fullwidth {
            width: 100%;
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 15px;
            font-size: 20px;
            font-weight: 700;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: background-color 0.3s;
        }
        button.search-btn-fullwidth:hover { background-color: #e65555; }

        .search-method-buttons { display: flex; gap: 15px; margin-bottom: 30px; justify-content: center; }

        .method-btn {
            flex: 1;
            padding: 18px 30px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            border: 3px solid var(--primary-color);
            background: var(--white);
            color: var(--primary-color);
            border-radius: 10px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .method-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .method-btn.active { background: var(--primary-color); color: var(--white); box-shadow: 0 4px 15px rgba(255,107,107,0.4); }

        /* ãƒãƒ³ã‚·ãƒ§ãƒ³ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .mansions-section {
            max-width: 1200px;
            margin: 60px auto;
            padding: 0 20px;
        }

        .section-title {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 40px;
            color: var(--dark-color);
        }

        .mansions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 24px;
        }

        .mansion-card {
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .mansion-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .mansion-status {
            position: absolute;
            top: 16px;
            right: 16px;
            background: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .mansion-header {
            padding: 20px;
            background: linear-gradient(135deg, #f8f8f8, #fff);
            border-bottom: 1px solid #eee;
        }

        .mansion-header h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--dark-color);
        }

        .mansion-address {
            font-size: 13px;
            color: #888;
        }

        .mansion-body { padding: 20px; }

        .hopefuls-highlight {
            background: linear-gradient(135deg, var(--primary-color), #ff8787);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 16px;
        }

        .hopefuls-number { font-size: 32px; font-weight: 700; }
        .hopefuls-text { font-size: 14px; opacity: 0.9; }

        .mansion-buyers-preview { margin-bottom: 16px; }
        .buyers-preview-title { font-size: 12px; color: #888; margin-bottom: 8px; }

        .buyer-preview {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }

        .buyer-preview-price { font-weight: 700; color: var(--primary-color); }
        .buyer-preview-info { color: #666; }

        .view-all-btn {
            width: 100%;
            padding: 12px;
            background: var(--dark-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.3s;
        }

        .view-all-btn:hover { background: #1a252f; }

        .load-more-btn {
            display: block;
            margin: 40px auto 0;
            padding: 15px 50px;
            background: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            border-radius: 30px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .load-more-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal.active { display: flex; align-items: flex-start; justify-content: center; padding: 40px 20px; }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 24px;
            background: linear-gradient(135deg, var(--primary-color), #ff8787);
            color: white;
            border-radius: 20px 20px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-header h2 { font-size: 24px; margin-bottom: 8px; }
        .modal-header p { opacity: 0.9; }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .modal-close:hover { background: rgba(255,255,255,0.3); }

        .modal-body { padding: 24px; }

        .buyer-card {
            background: #f8f8f8;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            position: relative;
        }

        .buyer-badge {
            position: absolute;
            top: -10px;
            left: 20px;
            background: #FFD700;
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }

        .buyer-price {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 16px;
        }

        .buyer-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .buyer-detail {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
        }

        .buyer-detail-icon { font-size: 16px; }

        .contact-buyer-btn {
            width: 100%;
            padding: 14px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .contact-buyer-btn:hover { opacity: 0.9; }

        .loading {
            text-align: center;
            padding: 60px;
            color: #888;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f0f0f0;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        footer {
            background: var(--dark-color);
            color: var(--white);
            padding: 40px 5%;
            margin-top: 80px;
            text-align: center;
        }
        footer p { color: #ccc; margin-bottom: 10px; }
        footer .copyright { font-size: 12px; color: #888; }

        @media (max-width: 768px) {
            .hero h1 { font-size: 28px; }
            .stats-container { gap: 15px; }
            .stat-card { min-width: 100%; padding: 20px; }
            header { flex-direction: column; gap: 15px; }
            nav { font-size: 14px; }
            .tab-button { padding: 10px 15px; font-size: 16px; }
            .search-box { flex-direction: column; }
            .mansions-grid { grid-template-columns: 1fr; }
            .buyer-details { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="campaign-banner">
        ã€æœŸé–“é™å®šã€‘ä»Šã ã‘ï¼æŸ»å®šä¾é ¼ã§Amazonã‚®ãƒ•ãƒˆåˆ¸æœ€å¤§5,000å††åˆ†ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ
    </div>
    <header>
        <a href="#" class="logo" aria-label="ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹">
            <img src="https://urico.jp/assets/img/logo.svg" alt="URICO ãƒ­ã‚´" />
            URICO
        </a>
        <nav>
            <a href="#">ãƒ›ãƒ¼ãƒ </a>
            <a href="#">æŸ»å®šä¾é ¼</a>
            <a href="#">ãŠå•ã„åˆã‚ã›</a>
        </nav>
    </header>

    <section class="hero" role="banner">
        <h1 id="heroTitle">URICO - ãƒãƒ³ã‚·ãƒ§ãƒ³å£²å´<span>ãƒãƒƒãƒãƒ³ã‚°</span></h1>
        <p id="heroSubtitle">25,463çµ„ã®è³¼å…¥å¸Œæœ›è€…ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æœ€é©ãªè²·ä¸»ã‚’è¦‹ã¤ã‘ã¾ã™</p>
    </section>

    <section class="stats-container">
        <div class="stat-card">
            <span class="number" id="statBuyers">-</span>
            <span class="label">è³¼å…¥å¸Œæœ›è€…æ•°</span>
        </div>
        <div class="stat-card">
            <span class="number" id="statProperties">-</span>
            <span class="label">å¯¾å¿œç‰©ä»¶æ•°</span>
        </div>
        <div class="stat-card">
            <span class="number" id="statSuccessRate">72.4%</span>
            <span class="label">æˆç´„ç‡</span>
        </div>
    </section>

    <section class="search-section">
        <div class="search-tabs" role="tablist">
            <button class="tab-button active" role="tab" aria-selected="true" id="tab-mansion-btn" type="button">ãƒãƒ³ã‚·ãƒ§ãƒ³</button>
            <button class="tab-button" role="tab" aria-selected="false" id="tab-house-btn" type="button">æˆ¸å»º</button>
            <button class="tab-button" role="tab" aria-selected="false" id="tab-land-btn" type="button">åœŸåœ°</button>
        </div>

        <!-- ãƒãƒ³ã‚·ãƒ§ãƒ³ã‚¿ãƒ– -->
        <div class="tab-content" id="tab-mansion">
            <div class="search-box">
                <input type="text" id="searchInputMansion" class="search-input" placeholder="ãƒãƒ³ã‚·ãƒ§ãƒ³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šD'ã‚¯ãƒ©ãƒ‡ã‚£ã‚¢ï¼‰" autocomplete="off">
                <button id="searchButtonMansion" class="search-btn" type="button">æ¤œç´¢ã™ã‚‹</button>
                <div id="suggestionsMansion" class="suggestions"></div>
            </div>
        </div>

        <!-- æˆ¸å»ºã‚¿ãƒ– -->
        <form id="tab-house" class="tab-content" style="display:none;">
            <div class="search-method-buttons">
                <button type="button" class="method-btn" id="house-method-station">é§…ã‹ã‚‰æ¢ã™</button>
                <button type="button" class="method-btn active" id="house-method-area">ã‚¨ãƒªã‚¢ã‹ã‚‰æ¢ã™</button>
            </div>
            
            <div id="house-station-search" style="display:none;">
                <div class="form-group">
                    <label for="house-railway">è·¯ç·šä¼šç¤¾å</label>
                    <select id="house-railway"><option value="">é¸æŠã—ã¦ãã ã•ã„</option></select>
                </div>
                <div class="form-group">
                    <label for="house-line">æ²¿ç·šå</label>
                    <select id="house-line" disabled><option value="">å…ˆã«è·¯ç·šä¼šç¤¾åã‚’é¸æŠã—ã¦ãã ã•ã„</option></select>
                </div>
                <div class="form-group">
                    <label for="house-station">é§…å</label>
                    <select id="house-station" disabled><option value="">å…ˆã«æ²¿ç·šåã‚’é¸æŠã—ã¦ãã ã•ã„</option></select>
                </div>
            </div>
            
            <div id="house-area-search">
                <div class="form-group">
                    <label for="house-prefecture">éƒ½é“åºœçœŒ</label>
                    <select id="house-prefecture"><option value="">é¸æŠã—ã¦ãã ã•ã„</option></select>
                </div>
                <div class="form-group">
                    <label for="house-city">å¸‚åŒºç”ºæ‘</label>
                    <select id="house-city" disabled><option value="">å…ˆã«éƒ½é“åºœçœŒã‚’é¸æŠã—ã¦ãã ã•ã„</option></select>
                </div>
            </div>
            
            <button type="submit" class="search-btn-fullwidth">æˆ¸å»ºã‚’æ¤œç´¢</button>
        </form>

        <!-- åœŸåœ°ã‚¿ãƒ– -->
        <form id="tab-land" class="tab-content" style="display:none;">
            <div class="search-method-buttons">
                <button type="button" class="method-btn" id="land-method-station">é§…ã‹ã‚‰æ¢ã™</button>
                <button type="button" class="method-btn active" id="land-method-area">ã‚¨ãƒªã‚¢ã‹ã‚‰æ¢ã™</button>
            </div>
            
            <div id="land-station-search" style="display:none;">
                <div class="form-group">
                    <label for="land-railway">è·¯ç·šä¼šç¤¾å</label>
                    <select id="land-railway"><option value="">é¸æŠã—ã¦ãã ã•ã„</option></select>
                </div>
                <div class="form-group">
                    <label for="land-line">æ²¿ç·šå</label>
                    <select id="land-line" disabled><option value="">å…ˆã«è·¯ç·šä¼šç¤¾åã‚’é¸æŠã—ã¦ãã ã•ã„</option></select>
                </div>
                <div class="form-group">
                    <label for="land-station">é§…å</label>
                    <select id="land-station" disabled><option value="">å…ˆã«æ²¿ç·šåã‚’é¸æŠã—ã¦ãã ã•ã„</option></select>
                </div>
            </div>
            
            <div id="land-area-search">
                <div class="form-group">
                    <label for="land-prefecture">éƒ½é“åºœçœŒ</label>
                    <select id="land-prefecture"><option value="">é¸æŠã—ã¦ãã ã•ã„</option></select>
                </div>
                <div class="form-group">
                    <label for="land-city">å¸‚åŒºç”ºæ‘</label>
                    <select id="land-city" disabled><option value="">å…ˆã«éƒ½é“åºœçœŒã‚’é¸æŠã—ã¦ãã ã•ã„</option></select>
                </div>
            </div>
            
            <button type="submit" class="search-btn-fullwidth">åœŸåœ°ã‚’æ¤œç´¢</button>
        </form>
    </section>

    <!-- ãƒãƒ³ã‚·ãƒ§ãƒ³ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section class="mansions-section" id="mansionsSection">
        <h2 class="section-title">è³¼å…¥å¸Œæœ›è€…ãŒå¤šã„<span style="color: var(--primary-color);">ãƒãƒ³ã‚·ãƒ§ãƒ³</span></h2>
        <div id="mansionsList" class="mansions-grid">
            <div class="loading" id="loadingIndicator">
                <div class="loading-spinner"></div>
                <p>ãƒãƒ³ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
            </div>
        </div>
        <button class="load-more-btn" id="loadMoreBtn" style="display:none;">ã‚‚ã£ã¨è¦‹ã‚‹</button>
    </section>

    <!-- è³¼å…¥å¸Œæœ›è€…è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="buyerModal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="closeModal()">Ã—</button>
                <h2 id="modalTitle">ãƒãƒ³ã‚·ãƒ§ãƒ³å</h2>
                <p id="modalSubtitle">è³¼å…¥å¸Œæœ›è€…æ•°</p>
            </div>
            <div class="modal-body" id="buyerCards">
                <!-- è³¼å…¥å¸Œæœ›è€…ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>

    <footer>
        <p>é–¢è¥¿æœ€å¤§ç´šã®ä¸å‹•ç”£å£²å´ãƒãƒƒãƒãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹</p>
        <p class="copyright">&copy; 2026 URICO All Rights Reserved.</p>
    </footer>

<script type="module">
// ãƒãƒ³ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { MANSION_DB } from './mansion_db.js';

// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
let railwayData = {};
let areaData = {};
let mansionDatabase = [];
let displayedCount = 20;

const statsData = {
    mansion: { title: "ãƒãƒ³ã‚·ãƒ§ãƒ³å£²å´<span>ãƒãƒƒãƒãƒ³ã‚°</span>", rate: "72.4%" },
    house: { title: "æˆ¸å»ºå£²å´<span>ãƒãƒƒãƒãƒ³ã‚°</span>", rate: "68.1%" },
    land: { title: "åœŸåœ°å£²å´<span>ãƒãƒƒãƒãƒ³ã‚°</span>", rate: "65.5%" }
};

// åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', async () => {
    // ãƒãƒ³ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’è¨­å®š
    mansionDatabase = MANSION_DB;
    
    // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
    updateMansionStats();
    
    // ãƒãƒ³ã‚·ãƒ§ãƒ³ä¸€è¦§ã‚’è¡¨ç¤º
    displayTopMansions();
    
    // å¤–éƒ¨JSONãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
    await loadExternalData();
    
    // å„æ©Ÿèƒ½ã‚’åˆæœŸåŒ–
    setupSearchMethodToggle('house');
    setupSearchMethodToggle('land');
    setup3TierRailwaySelect('house');
    setup3TierRailwaySelect('land');
    initializeTabSwitching();
    initializeMansionSearch();
    initializeHouseSearch();
    initializeLandSearch();
    
    // ã‚‚ã£ã¨è¦‹ã‚‹ãƒœã‚¿ãƒ³
    document.getElementById('loadMoreBtn').addEventListener('click', loadMoreMansions);
});

// çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
function updateMansionStats() {
    const totalBuyers = mansionDatabase.reduce((sum, m) => sum + (m.buyers?.length || 0), 0);
    const totalMansions = mansionDatabase.length;
    
    animateNumber('statBuyers', totalBuyers);
    animateNumber('statProperties', totalMansions);
    
    document.getElementById('heroSubtitle').textContent = 
        `${totalBuyers.toLocaleString()}çµ„ã®è³¼å…¥å¸Œæœ›è€…ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æœ€é©ãªè²·ä¸»ã‚’è¦‹ã¤ã‘ã¾ã™`;
}

// æ•°å­—ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º
function animateNumber(elementId, targetNumber) {
    const el = document.getElementById(elementId);
    if (!el) return;
    
    let current = 0;
    const increment = Math.ceil(targetNumber / 50);
    const timer = setInterval(() => {
        current += increment;
        if (current >= targetNumber) {
            current = targetNumber;
            clearInterval(timer);
        }
        el.textContent = current.toLocaleString();
    }, 30);
}

// ãƒãƒ³ã‚·ãƒ§ãƒ³ä¸€è¦§ã‚’è¡¨ç¤º
function displayTopMansions() {
    const container = document.getElementById('mansionsList');
    const loading = document.getElementById('loadingIndicator');
    const loadMoreBtn = document.getElementById('loadMoreBtn');
    
    if (!container) return;
    if (loading) loading.style.display = 'none';
    
    // è³¼å…¥å¸Œæœ›è€…æ•°ã§ã‚½ãƒ¼ãƒˆ
    const sortedMansions = [...mansionDatabase]
        .sort((a, b) => (b.buyers?.length || 0) - (a.buyers?.length || 0))
        .slice(0, displayedCount);
    
    container.innerHTML = sortedMansions.map(mansion => {
        const buyerCount = mansion.buyers?.length || 0;
        const topBuyers = (mansion.buyers || []).slice(0, 2);
        const hot = buyerCount >= 8 ? '<div class="mansion-status">HOT</div>' : '';
        
        return `
            <div class="mansion-card" onclick="showBuyerDetails('${mansion.name.replace(/'/g, "\\'")}')">
                ${hot}
                <div class="mansion-header">
                    <h3>${mansion.name}</h3>
                    <div class="mansion-address">ğŸ“ ${mansion.address || 'é–¢è¥¿ã‚¨ãƒªã‚¢'}</div>
                </div>
                <div class="mansion-body">
                    <div class="hopefuls-highlight">
                        <div class="hopefuls-number">${buyerCount}çµ„</div>
                        <div class="hopefuls-text">ã®è³¼å…¥å¸Œæœ›è€…</div>
                    </div>
                    <div class="mansion-buyers-preview">
                        <div class="buyers-preview-title">è³¼å…¥å¸Œæœ›è€…ï¼ˆä¸€éƒ¨ï¼‰</div>
                        ${topBuyers.map(b => `
                            <div class="buyer-preview">
                                <span class="buyer-preview-price">${b.price || 'ä¾¡æ ¼å¿œç›¸è«‡'}</span>
                                <span class="buyer-preview-info">${b.family || ''} / ${b.occupation || ''}</span>
                            </div>
                        `).join('')}
                    </div>
                    <button class="view-all-btn">å…¨${buyerCount}çµ„ã®è©³ç´°ã‚’è¦‹ã‚‹</button>
                </div>
            </div>
        `;
    }).join('');
    
    // ã‚‚ã£ã¨è¦‹ã‚‹ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
    if (loadMoreBtn) {
        loadMoreBtn.style.display = displayedCount < mansionDatabase.length ? 'block' : 'none';
    }
}

// ã‚‚ã£ã¨è¦‹ã‚‹
function loadMoreMansions() {
    displayedCount += 20;
    displayTopMansions();
}

// è³¼å…¥å¸Œæœ›è€…è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
window.showBuyerDetails = function(mansionName) {
    const mansion = mansionDatabase.find(m => m.name === mansionName);
    if (!mansion) return;
    
    const modal = document.getElementById('buyerModal');
    const title = document.getElementById('modalTitle');
    const subtitle = document.getElementById('modalSubtitle');
    const cards = document.getElementById('buyerCards');
    
    if (title) title.textContent = mansion.name;
    if (subtitle) subtitle.textContent = `${(mansion.buyers || []).length}çµ„ã®è³¼å…¥å¸Œæœ›è€…`;
    
    if (cards) {
        cards.innerHTML = (mansion.buyers || []).map((b, idx) => `
            <div class="buyer-card">
                ${idx === 0 ? '<div class="buyer-badge">æœ€é«˜é¡</div>' : ''}
                <div class="buyer-price">${b.price || 'ä¾¡æ ¼å¿œç›¸è«‡'}</div>
                <div class="buyer-details">
                    <div class="buyer-detail"><span class="buyer-detail-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span><span>${b.family || '-'}</span></div>
                    <div class="buyer-detail"><span class="buyer-detail-icon">ğŸ’¼</span><span>${b.occupation || '-'}</span></div>
                    <div class="buyer-detail"><span class="buyer-detail-icon">ğŸ“…</span><span>${b.timing || '-'}</span></div>
                    <div class="buyer-detail"><span class="buyer-detail-icon">ğŸ’³</span><span>${b.method || '-'}</span></div>
                    <div class="buyer-detail"><span class="buyer-detail-icon">ğŸ¯</span><span>${b.reason || '-'}</span></div>
                    <div class="buyer-detail"><span class="buyer-detail-icon">ğŸ‚</span><span>${b.age || '-'}</span></div>
                </div>
                <button class="contact-buyer-btn" onclick="contactBuyer(${idx})">ã“ã®è³¼å…¥å¸Œæœ›è€…ã«å£²å´ç›¸è«‡ã™ã‚‹</button>
            </div>
        `).join('');
    }
    
    modal.classList.add('active');
};

// ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
window.closeModal = function() {
    document.getElementById('buyerModal')?.classList.remove('active');
};

// è³¼å…¥å¸Œæœ›è€…ã«é€£çµ¡
window.contactBuyer = function(buyerId) {
    alert('å£²å´ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ ã¸ç§»å‹•ã—ã¾ã™ã€‚æ‹…å½“è€…ã‹ã‚‰æŠ˜ã‚Šè¿”ã—ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚');
};

// å¤–éƒ¨JSONãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
async function loadExternalData() {
    try {
        const [railwayRes, areaRes] = await Promise.all([
            fetch('./railway_data.json'),
            fetch('./area_data.json')
        ]);
        railwayData = await railwayRes.json();
        areaData = await areaRes.json();
        
        initializeRailwaySelects('house');
        initializeRailwaySelects('land');
        initializeAreaSelects('house');
        initializeAreaSelects('land');
    } catch (error) {
        console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
    }
}

// è·¯ç·šä¼šç¤¾ã®ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’åˆæœŸåŒ–
function initializeRailwaySelects(prefix) {
    const railwaySelect = document.getElementById(`${prefix}-railway`);
    if (!railwaySelect) return;
    
    railwaySelect.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
    Object.keys(railwayData).forEach(company => {
        const option = document.createElement('option');
        option.value = company;
        option.textContent = company;
        railwaySelect.appendChild(option);
    });
}

// æ¤œç´¢æ–¹æ³•åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
function setupSearchMethodToggle(prefix) {
    const stationBtn = document.getElementById(`${prefix}-method-station`);
    const areaBtn = document.getElementById(`${prefix}-method-area`);
    const stationSearch = document.getElementById(`${prefix}-station-search`);
    const areaSearch = document.getElementById(`${prefix}-area-search`);
    
    if (!stationBtn || !areaBtn) return;
    
    stationBtn.addEventListener('click', () => {
        stationBtn.classList.add('active');
        areaBtn.classList.remove('active');
        stationSearch.style.display = 'block';
        areaSearch.style.display = 'none';
    });
    
    areaBtn.addEventListener('click', () => {
        areaBtn.classList.add('active');
        stationBtn.classList.remove('active');
        areaSearch.style.display = 'block';
        stationSearch.style.display = 'none';
    });
}

// 3éšå±¤æ§‹é€ ã®é§…æ¤œç´¢æ©Ÿèƒ½
function setup3TierRailwaySelect(prefix) {
    const railwaySelect = document.getElementById(`${prefix}-railway`);
    const lineSelect = document.getElementById(`${prefix}-line`);
    const stationSelect = document.getElementById(`${prefix}-station`);
    
    if (!railwaySelect || !lineSelect || !stationSelect) return;
    
    railwaySelect.addEventListener('change', () => {
        const company = railwaySelect.value;
        lineSelect.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
        stationSelect.innerHTML = '<option value="">å…ˆã«æ²¿ç·šåã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
        stationSelect.disabled = true;
        
        if (company && railwayData[company]) {
            lineSelect.disabled = false;
            Object.keys(railwayData[company]).forEach(line => {
                const option = document.createElement('option');
                option.value = line;
                option.textContent = line;
                lineSelect.appendChild(option);
            });
        } else {
            lineSelect.disabled = true;
        }
    });
    
    lineSelect.addEventListener('change', () => {
        const company = railwaySelect.value;
        const line = lineSelect.value;
        stationSelect.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
        
        if (company && line && railwayData[company][line]) {
            stationSelect.disabled = false;
            railwayData[company][line].forEach(station => {
                const option = document.createElement('option');
                option.value = station;
                option.textContent = station;
                stationSelect.appendChild(option);
            });
        } else {
            stationSelect.disabled = true;
        }
    });
}

// ã‚¨ãƒªã‚¢ã‚»ãƒ¬ã‚¯ãƒˆåˆæœŸåŒ–
function initializeAreaSelects(prefix) {
    const prefSelect = document.getElementById(`${prefix}-prefecture`);
    const citySelect = document.getElementById(`${prefix}-city`);
    
    if (!prefSelect || !citySelect) return;
    
    prefSelect.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
    Object.keys(areaData).forEach(pref => {
        const option = document.createElement('option');
        option.value = pref;
        option.textContent = pref;
        prefSelect.appendChild(option);
    });
    
    prefSelect.addEventListener('change', () => {
        const selectedPref = prefSelect.value;
        citySelect.innerHTML = '<option value="">å…ˆã«éƒ½é“åºœçœŒã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
        citySelect.disabled = true;
        
        if (selectedPref && areaData[selectedPref]) {
            citySelect.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
            areaData[selectedPref].forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                citySelect.appendChild(option);
            });
            citySelect.disabled = false;
        }
    });
}

// ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
function initializeTabSwitching() {
    const tabs = document.querySelectorAll('.search-tabs button');
    const contents = {
        mansion: document.getElementById('tab-mansion'),
        house: document.getElementById('tab-house'),
        land: document.getElementById('tab-land'),
    };
    const mansionsSection = document.getElementById('mansionsSection');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const selectedType = tab.id.replace('tab-', '').replace('-btn', '');
            
            tabs.forEach(t => {
                const isSelected = (t === tab);
                t.classList.toggle('active', isSelected);
                t.setAttribute('aria-selected', isSelected ? 'true' : 'false');
            });
            
            Object.entries(contents).forEach(([key, element]) => {
                if (!element) return;
                element.style.display = (key === selectedType) ? 'block' : 'none';
            });
            
            // ãƒãƒ³ã‚·ãƒ§ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            if (mansionsSection) {
                mansionsSection.style.display = (selectedType === 'mansion') ? 'block' : 'none';
            }
            
            updateStats(selectedType);
        });
    });
    
    function updateStats(type) {
        const data = statsData[type];
        if (!data) return;
        document.getElementById('heroTitle').innerHTML = `URICO - ${data.title}`;
        document.getElementById('statSuccessRate').textContent = data.rate;
    }
}

// ãƒãƒ³ã‚·ãƒ§ãƒ³æ¤œç´¢
function initializeMansionSearch() {
    const inputMansion = document.getElementById('searchInputMansion');
    const suggestionsMansion = document.getElementById('suggestionsMansion');
    
    if (!inputMansion || !suggestionsMansion) return;
    
    inputMansion.addEventListener('input', () => {
        const query = inputMansion.value.toLowerCase();
        suggestionsMansion.innerHTML = '';
        
        if (query.length < 1) {
            suggestionsMansion.style.display = 'none';
            return;
        }
        
        const filtered = mansionDatabase
            .filter(m => (m.name || '').toLowerCase().includes(query))
            .slice(0, 10);
        
        if (filtered.length > 0) {
            filtered.forEach(mansion => {
                const item = document.createElement('div');
                item.classList.add('suggestion-item');
                item.innerHTML = `
                    <span class="mansion-name">${mansion.name}</span>
                    <span class="buyer-count">${(mansion.buyers || []).length}çµ„</span>
                `;
                item.addEventListener('click', () => {
                    inputMansion.value = mansion.name;
                    suggestionsMansion.style.display = 'none';
                    showBuyerDetails(mansion.name);
                });
                suggestionsMansion.appendChild(item);
            });
            suggestionsMansion.style.display = 'block';
        } else {
            suggestionsMansion.style.display = 'none';
        }
    });
    
    document.getElementById('searchButtonMansion').addEventListener('click', () => {
        const mansionName = inputMansion.value.trim();
        if (mansionName) {
            const mansion = mansionDatabase.find(m => 
                (m.name || '').toLowerCase().includes(mansionName.toLowerCase())
            );
            if (mansion) {
                showBuyerDetails(mansion.name);
            } else {
                alert('è©²å½“ã™ã‚‹ãƒãƒ³ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ç„¡æ–™æŸ»å®šã§ãŠæ¢ã—ã—ã¾ã™ã€‚');
            }
        } else {
            alert('ãƒãƒ³ã‚·ãƒ§ãƒ³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        }
    });
    
    // Enterã‚­ãƒ¼ã§æ¤œç´¢
    inputMansion.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            document.getElementById('searchButtonMansion').click();
        }
    });
    
    // å¤–éƒ¨ã‚¯ãƒªãƒƒã‚¯ã§å€™è£œã‚’é–‰ã˜ã‚‹
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-box')) {
            suggestionsMansion.style.display = 'none';
        }
    });
}

// æˆ¸å»ºæ¤œç´¢
function initializeHouseSearch() {
    const form = document.getElementById('tab-house');
    if (!form) return;
    
    form.addEventListener('submit', e => {
        e.preventDefault();
        const pref = document.getElementById('house-prefecture').value.trim();
        const city = document.getElementById('house-city').value.trim();
        const railway = document.getElementById('house-railway').value.trim();
        const line = document.getElementById('house-line').value.trim();
        const station = document.getElementById('house-station').value.trim();
        
        if (pref && city) {
            alert(`æˆ¸å»ºã®æŸ»å®š: ${pref} ${city} ã®è³¼å…¥å¸Œæœ›è€…ã‚’æ¤œç´¢ã—ã¾ã™ã€‚`);
        } else if (railway && station) {
            alert(`æˆ¸å»ºã®æŸ»å®š: ${railway} ${line} ${station} ã®è³¼å…¥å¸Œæœ›è€…ã‚’æ¤œç´¢ã—ã¾ã™ã€‚`);
        } else {
            alert('éƒ½é“åºœçœŒã¨å¸‚åŒºç”ºæ‘ã€ã¾ãŸã¯è·¯ç·šä¼šç¤¾åã¨é§…åã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
        }
    });
}

// åœŸåœ°æ¤œç´¢
function initializeLandSearch() {
    const form = document.getElementById('tab-land');
    if (!form) return;
    
    form.addEventListener('submit', e => {
        e.preventDefault();
        const pref = document.getElementById('land-prefecture').value.trim();
        const city = document.getElementById('land-city').value.trim();
        const railway = document.getElementById('land-railway').value.trim();
        const line = document.getElementById('land-line').value.trim();
        const station = document.getElementById('land-station').value.trim();
        
        if (pref && city) {
            alert(`åœŸåœ°ã®æŸ»å®š: ${pref} ${city} ã®è³¼å…¥å¸Œæœ›è€…ã‚’æ¤œç´¢ã—ã¾ã™ã€‚`);
        } else if (railway && station) {
            alert(`åœŸåœ°ã®æŸ»å®š: ${railway} ${line} ${station} ã®è³¼å…¥å¸Œæœ›è€…ã‚’æ¤œç´¢ã—ã¾ã™ã€‚`);
        } else {
            alert('éƒ½é“åºœçœŒã¨å¸‚åŒºç”ºæ‘ã€ã¾ãŸã¯è·¯ç·šä¼šç¤¾åã¨é§…åã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
        }
    });
}
</script>

</body>
</html>
